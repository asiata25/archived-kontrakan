openapi: "3.0.3"
info:
  title: API Documentation
  version: 1.0.0"
servers:
  - url: https://localhost/api/v1
paths:
  /login:
    post:
      summary: Login
      tags:
        - Auth
      requestBody:
        content:
          application/json:
            schema:
              allOf:
                - $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          token:
                            type: string
                          role:
                            type: string
  /logout:
    post:
      summary: Logout
      tags:
        - Auth
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Logout successful
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: unauthorized
  /users:
    get:
      summary: Get user details
      tags:
        - User
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Success get user details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          user:
                            allOf:
                              - $ref: "#/components/schemas/UserData"
                              - type: object
                                properties:
                                  username:
                                    type: string
                                  rental_block:
                                    $ref: "#/components/schemas/RentalBlockData"
    post:
      summary: Update user details and change password
      tags:
        - User
      security:
        - BearerAuth: []
      requestBody:
        content:
          multipart/form-data:
            schema:
              allOf:
                - $ref: "#/components/schemas/UserData"
      responses:
        "201":
          description: Success update user details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
  /users/credentials:
    put:
      summary: Update user's username and password
      tags:
        - User
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              allOf:
                - $ref: "#/components/schemas/LoginRequest"
                - type: object
                  properties:
                    password_old:
                      type: string
                    password:
                      type: string
                    password_confirmation:
                      type: string
      responses:
        "201":
          description: Success update user's username and password
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
  /invoices:
    get:
      summary: List all invoices
      tags:
        - Invoice
      security:
        - BearerAuth: []
      responses:
        "200":
          description: A list of invoices
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
                  - $ref: "#/components/schemas/MetaPagination"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          invoices:
                            type: array
                            items:
                              allOf:
                                - $ref: "#/components/schemas/InvoiceData"
                                - type: object
                                  properties:
                                    id:
                                      type: string
                                      format: uuid
                                    rental_block:
                                      $ref: "#/components/schemas/RentalBlockData"
    post:
      summary: Create a new invoice
      tags:
        - Invoice
      security:
        - BearerAuth: []
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                billing_month:
                  type: string
                  format: date
                amount:
                  type: integer
                receipt:
                  type: string
                  format: binary
      responses:
        "201":
          description: Success create new invoice
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          invoice:
                            type: object
                            properties:
                              id:
                                type: string
  /invoices/{id}:
    get:
      summary: Get invoice details
      tags:
        - Invoice
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Success get invoice details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          invoice:
                            allOf:
                              - $ref: "#/components/schemas/InvoiceData"
                              - type: object
                                properties:
                                  notes:
                                    type: string
                                  rental_block:
                                    $ref: "#/components/schemas/RentalBlockData"
                                  user:
                                    $ref: "#/components/schemas/UserData"
                                  receipts:
                                    type: array
                                    items:
                                      allOf:
                                        - $ref: "#/components/schemas/ReceiptData"
                                        - type: object
  /invoices/{invoice_id}/receipts:
    post:
      summary: Add receipt to current invoice
      tags:
        - Invoice
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: invoice_id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                receipt:
                  type: string
                  format: binary
                billing_month:
                  type: string
                  format: date
                amount:
                  type: integer
      responses:
        "201":
          description: Success upload receipt
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          invoice:
                            type: object
                            properties:
                              id:
                                type: string
                                format: uuid
  /invoices/{invoice_id}/receipts/{receipt_id}:
    put:
      summary: Update receipt
      tags:
        - Invoice
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: invoice_id
          required: true
          schema:
            type: string
            format: uuid
        - in: path
          name: receipt_id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                receipt:
                  type: string
                  format: binary
                payment_date:
                  type: string
                  format: date
                amount:
                  type: integer
      responses:
        "201":
          description: Success update invoice details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          invoice:
                            type: object
                            properties:
                              id:
                                type: string
                                format: uuid
  /admin/users:
    get:
      summary: List all users
      tags:
        - Admin Only Endpoints
      security:
        - BearerAuth: []
      responses:
        "200":
          description: A list of users
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
                  - $ref: "#/components/schemas/MetaPagination"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          users:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: string
                                  format: uuid
                                fullname:
                                  type: string
                                phone_number:
                                  type: string
                                rental_block:
                                  $ref: "#/components/schemas/RentalBlockData"
    post:
      summary: Add new user
      tags:
        - Admin Only Endpoints
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              allOf:
                - $ref: "#/components/schemas/LoginRequest"
                - type: object
                  properties:
                    block_id:
                      type: string
                      format: uuid
                    entry_date:
                      type: string
                      format: date
      responses:
        "201":
          description: Success create new user
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          user:
                            type: object
                            properties:
                              id:
                                type: string
  /admin/users/{id}:
    get:
      summary: Get user details
      tags:
        - Admin Only Endpoints
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Success get user details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          user:
                            allOf:
                              - $ref: "#/components/schemas/UserData"
                              - type: object
                                properties:
                                  id:
                                    type: string
                                    format: uuid
                                  rental_block:
                                    allOf:
                                      - $ref: "#/components/schemas/RentalBlockData"
                                      - type: object
                                        properties:
                                          id:
                                            type: string
                                            format: uuid
    put:
      summary: Update user details and change password
      tags:
        - Admin Only Endpoints
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              allOf:
                - $ref: "#/components/schemas/UserData"
                - properties:
                    password:
                      type: string
                    password_confirmation:
                      type: string
      responses:
        "200":
          description: Success update user details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: string
    delete:
      summary: Delete current user
      tags:
        - Admin Only Endpoints
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Success delete current user
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
  /admin/blocks:
    get:
      summary: List all rental blocks
      tags:
        - Admin Only Endpoints
      security:
        - BearerAuth: []
      responses:
        "200":
          description: A list of rental blocks
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
                  - $ref: "#/components/schemas/MetaPagination"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          rental_blocks:
                            type: array
                            items:
                              allOf:
                                - $ref: "#/components/schemas/RentalBlockData"
                                - $ref: "#/components/schemas/MetaPagination"
                                - type: object
                                  properties:
                                    id:
                                      type: string
                                      format: uuid
                                    user_id:
                                      type: string
                                      format: uuid
    post:
      summary: Create new rental block
      tags:
        - Admin Only Endpoints
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                price:
                  type: number
                user_id:
                  type: string
                  format: uuid
              required:
                - name
                - price
      responses:
        "201":
          description: Success create new rental block
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          rental_block:
                            type: object
                            properties:
                              id:
                                type: string
                                format: uuid
  /admin/blocks/{id}:
    put:
      summary: Update rental block details
      tags:
        - Admin Only Endpoints
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                price:
                  type: number
                user_id:
                  type: string
                  format: uuid
                entry_date:
                  type: string
                  format: date
              required:
                - name
                - price
      responses:
        "201":
          description: Success create new rental block
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          rental_block:
                            type: object
                            properties:
                              id:
                                type: string
                                format: uuid
    delete:
      summary: Delete current rental block
      tags:
        - Admin Only Endpoints
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Success delete current rental block
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
  /admin/blocks/{id}/users:
    delete:
      summary: Detatch rental block from user
      tags:
        - Admin Only Endpoints
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Success detatch rental block from user
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
  /admin/invoices:
    get:
      summary: List all invoices
      tags:
        - Admin Only Endpoints
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: start_date
          schema:
            type: string
            format: date
        - in: query
          name: end_date
          schema:
            type: string
            format: date
        - in: query
          name: status
          schema:
            type: string
      responses:
        "200":
          description: A list of invoices
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
                  - $ref: "#/components/schemas/MetaPagination"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          invoices:
                            type: array
                            items:
                              allOf:
                                - $ref: "#/components/schemas/InvoiceData"
                                - type: object
                                  properties:
                                    id:
                                      type: string
                                      format: uuid
                                - type: object
                                  properties:
                                    rental_block:
                                      $ref: "#/components/schemas/RentalBlockData"
  /admin/invoices/{id}:
    put:
      summary: Update invoice status
      tags:
        - Admin Only Endpoints
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                notes:
                  type: string
              required:
                - status
      responses:
        "200":
          description: Success update invoice status
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
components:
  securitySchemes:
    BearerAuth:
      type: apiKey
      name: Authorization
      in: header
      description: "example: Bearer token"
  schemas:
    SuccessResponse:
      type: object
      properties:
        message:
          type: string
        data:
          type: object
        error:
          type: object
          example: null
    MetaPagination:
      type: object
      properties:
        meta:
          type: object
          properties:
            current_page:
              type: integer
            per_page:
              type: integer
            from:
              type: integer
            to:
              type: integer
            next_page_url:
              type: string
            prev_page_url:
              type: string
            path:
              type: string
    UserData:
      type: object
      properties:
        fullname:
          type: string
        address:
          type: string
        identity_number:
          type: string
        phone_number:
          type: string
        identity_image:
          format: binary
    LoginRequest:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
      required:
        - username
        - password
    RegisterRequest:
      allOf:
        - $ref: "#/components/schemas/LoginRequest"
        - type: object
          properties:
            password_confirmation:
              type: string
            address:
              type: string
            identity_number:
              type: string
            phone_number:
              type: string
          required:
            - password_confirmation
    RentalBlockData:
      type: object
      properties:
        name:
          type: string
        price:
          type: integer
        entry_date:
          type: string
          format: date
    InvoiceData:
      type: object
      properties:
        deposit:
          type: integer
        billing_month:
          type: string
          format: date
        status:
          type: string
        price:
          type: integer
    ReceiptData:
      type: object
      properties:
        url:
          type: string
          format: binary
        payment_date:
          type: string
          format: date
        amount:
          type: integer
  requestBodies:
    ReceiptRequest:
      required: true
      content:
        multipart/form-data:
          schema:
            $ref: "#/components/schemas/ReceiptData"
